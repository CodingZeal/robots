#!/usr/bin/env ruby

require "robots"
require "optparse"
require "ostruct"

def parse_options
  options = OpenStruct.new

  parser = OptionParser.new do |opts|
    opts.banner = "Usage: #{opts.program_name} [options]"
    opts.version = Robots::VERSION

    opts.on("-a", "--all", "Iterate over all possible targets") do
      options.all = true
    end

    opts.on("-c", "--chain", "Solve all targets starting from the end of the previous solution") do
      options.chain = true
    end

    opts.on("-g", "--goal color,shape", Array,
            "The destination target for the robot to move to",
            "  (example: --goal green,circle or --goal vortex)") do |color, shape|
      options.goal = Robots::Target.new(color, shape)
    end

    opts.on("-s", "--seed SEED", Integer, "The seed for the random number generator") do |seed|
      options.seed = seed
    end

    opts.on_tail("-h", "--help", "Shows this help screen") do
      puts opts
      exit
    end

    opts.on_tail("--version", "Show version information") do
      puts opts.ver
      exit
    end
  end

  parser.parse!

  unless options.goal || options.all || options.chain
    $stderr.puts "Please specify a goal for the robot"
    exit 1
  end

  options
end

Robots::CLI.new(parse_options).run
