#!/usr/bin/env ruby

require "robots"
require "optparse"
require "ostruct"

def parse_options
  options = OpenStruct.new

  parser = OptionParser.new do |opts|
    opts.banner = "Usage: #{opts.program_name} [options]"
    opts.version = Robots::VERSION

    opts.on("-g", "--goal color,shape", Array,
            "The destination target for the robot to move to",
            "  (example: --goal green,circle or --goal vortex)") do |color, shape|
      options.goal = Robots::Target.new(color, shape)
    end

    opts.on_tail("-h", "--help", "Shows this help screen") do
      puts opts
      exit
    end

    opts.on_tail("--version", "Show version information") do
      puts opts.ver
      exit
    end
  end

  parser.parse!

  unless options.goal
    $stderr.puts "Please specify a goal for the robot"
    exit 1
  end

  options
end

module Robots
  options = parse_options

  board = Board.new
  BoardMaker.new(board).populate_example
  goal = options.goal
  color = goal.color
  color = :silver if color == :any
  robot = Robot.new(color, board.cell(6, 14))

  solver = Solvers::RecursiveDfs.new(robot, options.goal)

  if solver.solved?
    puts "Solved in #{solver.solution.size} moves:"
    solver.solution.each_with_index do |move, index|
      puts "  #{index+1}) #{move.capitalize}"
    end
  else
    puts "No solution found."
  end
end
